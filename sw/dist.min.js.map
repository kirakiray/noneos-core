{"version":3,"file":"dist.min.js","sources":["src/modules/file-system.js","src/modules/mime-types.js","../nos/fs/handle/mount/db.js","src/main.js","src/modules/nostool-handle.js","src/modules/nos-handle.js","src/modules/github-handler.js","src/modules/npm-handler.js","src/modules/mount-handle.js","src/modules/file-handler.js"],"sourcesContent":["let rootHandle = null;\n\n/**\n * 获取根目录句柄\n * @returns {Promise<FileSystemDirectoryHandle>} 根目录句柄\n */\nexport const getRootDirectory = async () => {\n  if (!rootHandle) {\n    rootHandle = await navigator.storage.getDirectory();\n  }\n\n  return rootHandle;\n};\n\n/**\n * 获取文件句柄\n * @param {Object} options - 选项\n * @param {string} options.path - 文件路径\n * @param {boolean} [options.create] - 是否创建文件（如果不存在）\n * @returns {Promise<FileSystemFileHandle>} 文件句柄\n */\nexport const getFileHandle = async ({ path, create }) => {\n  const rootHandle = await getRootDirectory();\n\n  const paths = path.split(\"/\");\n  if (paths[0] === \"\") {\n    paths.shift();\n  }\n\n  let currentHandle = rootHandle;\n  let lastId = paths.length - 1;\n  for (let i = 0; i < lastId; i++) {\n    if (i == lastId) {\n      break;\n    }\n    const p = paths[i];\n    currentHandle = await currentHandle.getDirectoryHandle(p, { create });\n  }\n\n  const fileHandle = await currentHandle.getFileHandle(\n    paths[paths.length - 1],\n    { create }\n  );\n\n  return fileHandle;\n};","/**\n * 根据文件扩展名获取 Content-Type\n * @param {string} path - 文件路径\n * @returns {string} Content-Type 值\n */\nexport const getContentType = (path) => {\n  const prefix = path.split(\".\").slice(-1)[0];\n\n  switch (prefix) {\n    case \"html\":\n    case \"htm\":\n      return \"text/html; charset=utf-8\";\n    case \"txt\":\n    case \"md\":\n      return \"text/plain; charset=utf-8\";\n    case \"js\":\n    case \"mjs\":\n      return \"application/javascript; charset=utf-8\";\n    case \"json\":\n      return \"application/json; charset=utf-8\";\n    case \"css\":\n      return \"text/css; charset=utf-8\";\n    case \"xml\":\n      return \"application/xml; charset=utf-8\";\n    case \"svg\":\n      return \"image/svg+xml; charset=utf-8\";\n    case \"csv\":\n      return \"text/csv; charset=utf-8\";\n    case \"ics\":\n      return \"text/calendar; charset=utf-8\";\n    case \"pdf\":\n      return \"application/pdf; charset=utf-8\";\n    case \"doc\":\n    case \"docx\":\n      return \"application/msword; charset=utf-8\";\n    case \"xls\":\n    case \"xlsx\":\n      return \"application/vnd.ms-excel; charset=utf-8\";\n    case \"ppt\":\n    case \"pptx\":\n      return \"application/vnd.ms-powerpoint; charset=utf-8\";\n    case \"zip\":\n      return \"application/zip; charset=utf-8\";\n    case \"gz\":\n      return \"application/gzip; charset=utf-8\";\n    case \"tar\":\n      return \"application/x-tar; charset=utf-8\";\n    case \"jpg\":\n    case \"jpeg\":\n      return \"image/jpeg\";\n    case \"png\":\n      return \"image/png\";\n    case \"gif\":\n      return \"image/gif\";\n    case \"bmp\":\n      return \"image/bmp\";\n    case \"ico\":\n      return \"image/x-icon\";\n    case \"webp\":\n      return \"image/webp\";\n    case \"bmp\":\n      return \"image/bmp\";\n    case \"mp3\":\n      return \"audio/mpeg\";\n    case \"wav\":\n      return \"audio/wav\";\n    case \"mp4\":\n    case \"m4v\":\n      return \"video/mp4\";\n    case \"mov\":\n      return \"video/quicktime\";\n    case \"avi\":\n      return \"video/x-msvideo\";\n    default:\n      if (path.split(\"/\").slice(-1)[0].includes(\"esm\")) {\n        return \"application/javascript; charset=utf-8\";\n      }\n\n      return \"application/octet-stream\";\n  }\n};\n","// db相关的操作\nlet _handleDB = null;\nconst getHandleDB = async () => {\n  if (_handleDB) return _handleDB;\n\n  return new Promise((resolve) => {\n    const req = indexedDB.open(\"handles-db\", 1);\n    req.onupgradeneeded = () =>\n      req.result.createObjectStore(\"handles\", { keyPath: \"id\" });\n    req.onsuccess = () => {\n      _handleDB = req.result;\n      resolve(req.result);\n    };\n    req.onerror = (e) => {\n      _handleDB = null;\n    };\n    req.onblocked = () => {\n      _handleDB = null;\n    };\n  });\n};\n\n// 保存（自动生成唯一ID，返回ID值）\nexport const saveHandle = async (handle) => {\n  const db = await getHandleDB();\n\n  let id;\n  if (handle.getUniqueId) {\n    id = await handle.getUniqueId();\n  } else {\n    id = `${handle.kind}-${Date.now()}`;\n    const allHandles = await getAllHandles();\n\n    let targetItem = null;\n\n    await Promise.all(\n      allHandles.map((item) => {\n        const result = item.handle.isSameEntry(handle);\n        targetItem = item;\n        return result;\n      })\n    );\n\n    if (targetItem) {\n      // 已经挂载过了\n      return targetItem.id;\n    }\n  }\n\n  await db.transaction(\"handles\", \"readwrite\").objectStore(\"handles\").put({\n    id,\n    handle,\n    time: Date.now(),\n  });\n\n  return id;\n};\n\n// 获取所有句柄列表（含ID和名称）\nexport const getAllHandles = async () => {\n  const db = await getHandleDB();\n  return new Promise((resolve) => {\n    db.transaction(\"handles\").objectStore(\"handles\").getAll().onsuccess = (\n      e\n    ) => {\n      resolve(e.target.result);\n    };\n  });\n};\n\n// 加载指定ID的句柄\nexport const loadHandle = async (id) => {\n  const db = await getHandleDB();\n  return new Promise((resolve, reject) => {\n    const req = db.transaction(\"handles\").objectStore(\"handles\").get(id);\n    req.onsuccess = (e) => {\n      const result = e.target.result;\n      resolve(result ? result.handle : null);\n    };\n    req.onerror = () => {\n      reject(req.error);\n    };\n  });\n};\n\n// 删除指定ID\nexport const deleteHandle = async (id) => {\n  const db = await getHandleDB();\n  await db\n    .transaction(\"handles\", \"readwrite\")\n    .objectStore(\"handles\")\n    .delete(id);\n};\n","import { handleGitHubRequest } from \"./modules/github-handler.js\";\nimport { handleFileRequest } from \"./modules/file-handler.js\";\nimport { handleNpmRequest } from \"./modules/npm-handler.js\";\nimport { handleMountRequest } from \"./modules/mount-handle.js\";\nimport { handleNosRequest } from \"./modules/nos-handle.js\";\nimport { handleNosToolRequest } from \"./modules/nostool-handle.js\";\n\n// 当前系统的配置信息\n// let systemConfig = {\"version\":\"4.0.0\",\"mode\":\"online\",\"nosMapPath\":\"nos-4.0.0\"};\nlet systemConfig = {};\n\nconst NONEOS_CORE_VERSION = \"noneos-core@4.0.4\";\n\nself.addEventListener(\"fetch\", (event) => {\n  const { request } = event;\n  const { pathname } = new URL(request.url);\n\n  // console.log(\"pathname: \", pathname);\n\n  if (pathname === \"/__version\") {\n    return event.respondWith(\n      new Response(NONEOS_CORE_VERSION.replace(\"noneos-core@\", \"\")),\n    );\n  }\n\n  if (pathname === \"/__config\") {\n    return event.respondWith(reloadSystemConfig());\n  }\n\n  try {\n    if (\n      globalThis?.SERVER_OPTIONS?.useNosTool &&\n      /^\\/nos-tool\\//.test(pathname)\n    ) {\n      return event.respondWith(\n        handleNosToolRequest({\n          path: pathname,\n          request,\n          systemConfig,\n        }),\n      );\n    }\n\n    if (/^\\/nos\\//.test(pathname)) {\n      return event.respondWith(\n        handleNosRequest({\n          path: pathname,\n          request,\n          systemConfig,\n        }),\n      );\n    }\n\n    if (/^\\/gh\\//.test(pathname)) {\n      // 从 GitHub 仓库获取文件\n      return event.respondWith(\n        handleGitHubRequest({\n          path: pathname,\n          originUrl: request.url,\n          systemConfig,\n        }),\n      );\n    }\n\n    if (/^\\/npm\\//.test(pathname)) {\n      // 从 NPM CDN 获取包文件\n      return event.respondWith(\n        handleNpmRequest({\n          path: pathname,\n          originUrl: request.url,\n          systemConfig,\n        }),\n      );\n    }\n\n    if (/^\\/\\$mount-/.test(pathname)) {\n      return event.respondWith(\n        handleMountRequest({\n          path: pathname,\n          originUrl: request.url,\n          systemConfig,\n        }),\n      );\n    }\n\n    if (/^\\/\\$/.test(pathname)) {\n      return event.respondWith(\n        handleFileRequest({\n          path: pathname,\n          originUrl: request.url,\n          systemConfig,\n        }),\n      );\n    }\n  } catch (err) {\n    return new Response(err.stack || err.toString(), {\n      status: 400,\n    });\n  }\n\n  if (/^\\/_/.test(pathname)) {\n    // 隐藏目录开头的，属于本地文件，无需代理\n    return;\n  }\n});\n\nself.addEventListener(\"install\", () => {\n  self.skipWaiting();\n  console.log(\"NoneOS installation successful\");\n});\n\nself.addEventListener(\"activate\", () => {\n  self.clients.claim();\n  console.log(\"NoneOS server activation successful\");\n\n  setTimeout(() => {\n    reloadSystemConfig();\n  }, 1000);\n});\n\nconst reloadSystemConfig = async () => {\n  try {\n    const rootHandle = await navigator.storage.getDirectory();\n    const configHandle = await rootHandle.getDirectoryHandle(\"nos-config\");\n    const configFileHandle = await configHandle.getFileHandle(\"system.json\");\n    const file = await configFileHandle.getFile();\n    const content = await file.text();\n\n    if (content) {\n      systemConfig = JSON.parse(content);\n    }\n\n    return new Response(JSON.stringify(systemConfig));\n  } catch (err) {\n    console.error(\"Reload system config failed:\", err);\n    return new Response(\"Reload failed: \" + (err.message || err), {\n      status: 500,\n    });\n  }\n};\n","export const handleNosToolRequest = async ({ request }) => {\n  const host = location.host;\n\n  if (host === \"localhost:3002\") {\n    return fetch(request);\n  }\n\n  if (/^localhost:/.test(host)) {\n    const newUrl = request.url.replace(/:(\\d+)/, \":3002\");\n    try {\n      return await fetch(newUrl);\n    } catch {\n      return await fetch(request.url);\n    }\n  }\n\n  const afterHost = request.url.replace(/^https?:\\/\\/[^\\/]+\\//, \"\");\n  return fetch(`https://core.noneos.com/${afterHost}`);\n};\n","import { getFileHandle } from \"./file-system.js\";\nimport { getContentType } from \"./mime-types.js\";\n\nexport const handleNosRequest = async ({ path, request, systemConfig }) => {\n  if (!systemConfig || !systemConfig.mode || systemConfig.mode === \"online\") {\n    // 没有配置数据时，直接返回线上数据\n    return fetch(request);\n  }\n\n  if (systemConfig.mode === \"local\") {\n    try {\n      const rePath = path.replace(/^\\/nos\\//, systemConfig.nosMapPath + \"/\");\n\n      let targetHandle = await getFileHandle({ path: rePath }).catch(\n        () => null,\n      );\n\n      if (targetHandle) {\n        const fileStream = await targetHandle.getFile();\n\n        if (fileStream.size) {\n          return new Response(fileStream, {\n            headers: {\n              \"Content-Type\": getContentType(path),\n            },\n          });\n        }\n      }\n\n      return fetch(request);\n    } catch (err) {\n      return fetch(request);\n    }\n  }\n};\n","import { getFileHandle } from \"./file-system.js\";\nimport { getContentType } from \"./mime-types.js\";\n\n/**\n * 从 GitHub 仓库获取文件\n * @param {Object} options - 选项\n * @param {string} options.path - 请求路径\n * @param {string} options.originUrl - 原始请求 URL\n * @returns {Promise<Response>} 响应对象\n */\nexport const handleGitHubRequest = async ({ path }) => {\n  // 将 /gh/ 路径转换为 jsDelivr CDN URL\n  const rePath = path.replace(/^\\/gh\\//, \"https://cdn.jsdelivr.net/gh/\");\n  // const rePath = path.replace(/^\\/gh\\//, \"https://cdn.statically.io/gh/\");\n  // console.log(\"gh: \", rePath);\n\n  let targetHandle = await getFileHandle({ path }).catch(() => null);\n\n  if (targetHandle) {\n    const fileStream = await targetHandle.getFile();\n    if (fileStream.size) {\n      return new Response(fileStream, {\n        headers: {\n          \"Content-Type\": getContentType(path),\n        },\n      });\n    }\n  }\n\n  // 请求实际文件\n  const response = await fetch(rePath);\n  const blob = await response.blob();\n\n  // 写入缓存\n  targetHandle = await getFileHandle({ path, create: true });\n  const writeStream = await targetHandle.createWritable();\n  await writeStream.write(blob);\n  await writeStream.close();\n\n  // 转化为新的 Response 对象\n  return new Response(blob, {\n    headers: {\n      \"Content-Type\": getContentType(path),\n    },\n  });\n};\n","import { getFileHandle } from \"./file-system.js\";\nimport { getContentType } from \"./mime-types.js\";\n\n/**\n * 从 NPM CDN 获取包文件\n * @param {Object} options - 选项\n * @param {string} options.path - 请求路径\n * @param {string} options.originUrl - 原始请求 URL\n * @returns {Promise<Response>} 响应对象\n */\nexport const handleNpmRequest = async ({ path }) => {\n  // 将 /npm/ 路径转换为 jsDelivr CDN URL\n  // 例如: /npm/jquery@3.6.0/dist/jquery.min.js\n  // 转换为: https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js\n  const rePath = path.replace(/^\\/npm\\//, \"https://cdn.jsdelivr.net/npm/\");\n\n  console.log(\"npm request: \", rePath);\n\n  let targetHandle = await getFileHandle({ path }).catch(() => null);\n\n  if (targetHandle) {\n    const fileStream = await targetHandle.getFile();\n    if (fileStream.size) {\n      const type = fileStream.type || getContentType(path);\n      return new Response(fileStream, {\n        headers: {\n          \"Content-Type\": type,\n        },\n      });\n    }\n  }\n\n  try {\n    // 请求实际文件\n    const response = await fetch(rePath);\n\n    // 检查响应状态\n    if (!response.ok) {\n      throw new Error(\n        `Failed to fetch ${rePath}: ${response.status} ${response.statusText}`\n      );\n    }\n\n    const blob = await response.blob();\n\n    // 写入缓存\n    targetHandle = await getFileHandle({ path, create: true });\n    const writeStream = await targetHandle.createWritable();\n    await writeStream.write(blob);\n    await writeStream.close();\n\n    const type = blob.type || getContentType(path);\n\n    // 转化为新的 Response 对象\n    return new Response(blob, {\n      headers: {\n        \"Content-Type\": type,\n      },\n    });\n  } catch (error) {\n    console.error(\"Error fetching npm package:\", error);\n\n    return new Response(`Error fetching npm package: ${error.message}`, {\n      status: 500,\n      headers: {\n        \"Content-Type\": \"text/plain; charset=utf-8\",\n      },\n    });\n  }\n};\n","import { loadHandle } from \"../../../nos/fs/handle/mount/db\";\nimport { getContentType } from \"./mime-types.js\";\n\nexport const handleMountRequest = async ({ path, originUrl }) => {\n  let pathname = decodeURIComponent(path);\n\n  if (/\\/$/.test(path)) {\n    pathname += \"index.html\";\n  }\n\n  const mountedId = pathname.replace(/\\/\\$mount\\-(.+)>.+/, \"$1\");\n  const pathsArr = pathname.split(\"/\").slice(2);\n\n  // 改用直接的 opfs 读取文件方法\n  try {\n    const rootHandle = await loadHandle(mountedId);\n\n    if (!rootHandle) {\n      throw new Error(`Mounted ID ${mountedId} not found`);\n    }\n\n    let finalHandle = rootHandle;\n    for (let i = 0; i < pathsArr.length; i++) {\n      let part = pathsArr[i];\n      const isLast = i === pathsArr.length - 1;\n      if (isLast) {\n        if (part === \"\") {\n          part = \"index.html\";\n        }\n        finalHandle = await finalHandle.getFileHandle(part);\n      } else {\n        finalHandle = await finalHandle.getDirectoryHandle(part);\n      }\n    }\n\n    const prefix = pathname.split(\".\").pop();\n\n    return new Response(await finalHandle.getFile(), {\n      status: 200,\n      headers: {\n        \"Content-Type\": getContentType(prefix),\n      },\n    });\n  } catch (err) {\n    return new Response(err.stack || err.toString(), {\n      status: 400,\n    });\n  }\n};\n","import { getFileHandle } from './file-system.js';\nimport { getContentType } from './mime-types.js';\n\n/**\n * 从本地文件系统获取文件\n * @param {Object} options - 选项\n * @param {string} options.path - 请求路径\n * @param {string} options.originUrl - 原始请求 URL\n * @returns {Promise<Response>} 响应对象\n */\nexport const handleFileRequest = async ({ path }) => {\n  const rePath = path.replace(/^\\/\\$/, \"\");\n\n  const fileHandle = await getFileHandle({ path: rePath }).catch(() => null);\n\n  if (fileHandle) {\n    const fileStream = await fileHandle.getFile();\n    if (fileStream.size) {\n      return new Response(fileStream, {\n        headers: {\n          \"Content-Type\": getContentType(path),\n        },\n      });\n    }\n  }\n\n  return new Response(\"Not Found\", {\n    status: 404,\n    headers: {\n      \"Content-Type\": getContentType(path),\n    },\n  });\n};"],"names":["rootHandle","getRootDirectory","async","navigator","storage","getDirectory","getFileHandle","path","create","paths","split","shift","currentHandle","lastId","length","i","p","getDirectoryHandle","getContentType","slice","includes","_handleDB","loadHandle","id","db","Promise","resolve","req","indexedDB","open","onupgradeneeded","result","createObjectStore","keyPath","onsuccess","onerror","e","onblocked","getHandleDB","reject","transaction","objectStore","get","target","handle","error","systemConfig","self","addEventListener","event","request","pathname","URL","url","respondWith","Response","replace","reloadSystemConfig","globalThis","SERVER_OPTIONS","useNosTool","test","host","location","fetch","newUrl","afterHost","handleNosToolRequest","mode","rePath","nosMapPath","targetHandle","catch","fileStream","getFile","size","headers","err","handleNosRequest","response","blob","writeStream","createWritable","write","close","handleGitHubRequest","originUrl","console","log","type","ok","Error","status","statusText","message","handleNpmRequest","decodeURIComponent","mountedId","pathsArr","finalHandle","part","prefix","pop","stack","toString","handleMountRequest","fileHandle","handleFileRequest","skipWaiting","clients","claim","setTimeout","configHandle","configFileHandle","file","content","text","JSON","parse","stringify"],"mappings":"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"}